<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · Ewalder.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://SunnySuite.github.io/Ewalder.jl/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Ewalder.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Usage-example"><span>Usage example</span></a></li><li><a class="tocitem" href="#What-is-Ewald-summation?"><span>What is Ewald summation?</span></a></li><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SunnySuite/Ewalder.jl/blob/main/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Ewalder"><a class="docs-heading-anchor" href="#Ewalder">Ewalder</a><a id="Ewalder-1"></a><a class="docs-heading-anchor-permalink" href="#Ewalder" title="Permalink"></a></h1><p>Documentation for the Julia package <a href="https://github.com/SunnySuite/Ewalder.jl">Ewalder.jl</a> to perform Ewald summation.</p><h2 id="Usage-example"><a class="docs-heading-anchor" href="#Usage-example">Usage example</a><a id="Usage-example-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-example" title="Permalink"></a></h2><p>Calculate the <a href="https://en.wikipedia.org/wiki/Madelung_constant">Madelung constant</a> for NaCl using its primitive cell.</p><pre><code class="language-julia hljs">import Ewalder

latvecs = [[1,1,0], [1,0,1], [0,1,1]]
pos = [[0,0,0], [1,1,1]]
charges = [1, -1]
sys = Ewalder.System(; latvecs, pos)
E = Ewalder.energy(sys; charges)
@assert E ≈ -1.74756459</code></pre><p>See the <a href="https://github.com/SunnySuite/Ewalder.jl/tree/main/test"><code>Ewalder/test</code></a> directory for more usage examples.</p><h2 id="What-is-Ewald-summation?"><a class="docs-heading-anchor" href="#What-is-Ewald-summation?">What is Ewald summation?</a><a id="What-is-Ewald-summation?-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-Ewald-summation?" title="Permalink"></a></h2><h3 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h3><p>The Coulomb energy between two point charges is <span>$q_1 q_2 / 4\pi\epsilon_0 r$</span>, where <span>$r$</span> is the separation distance, and <span>$\epsilon_0$</span> is a physical constant (the vacuum permittivity). For a system with multiple charges, the total Coulomb energy is a sum of all such pair interactions. A frequent goal is to estimate bulk material properties using computers simulations at much smaller scales. Here, it is very effective to impose periodic boundary conditions on the finite size simulation volume. Doing so effectively creates infinitely many copies (image charges) of the charges present in the original, finite size system. Ewald summation accounts for the interactions of all these charges through long-range (<span>$1/r$</span>) pair interactions. In the <em>Ewalder</em> example above, the output <code>E</code> represents the dimensionless energy per ion of the NaCl crystal, i.e., table salt.</p><p>There are some mathematical subtleties to Ewald summation. First, the system must be net charge neutral, or the macroscopic Coulomb energy will diverge. Second, if the original system has a nonzero net dipole moment (i.e., a polarization), then the infinite sum over periodic images becomes only conditionally convergent, and the result depends on the order of summation. This conditional convergence reflects a true ambiguity–-the physical conditions at the surface of the material sample cannot be neglected. The simplest possibility, employed here, is to impose so-called &quot;tin foil boundary conditions,&quot; which eliminate bound charge from the sample surface.</p><p>Ewald summation works by decomposing the Coulomb energy into two parts: (1) A real-space part, evaluated as a sum over point charges at short range, and (2) a Fourier space part, which captures the long-range interactions through a sum over <span>$\mathbf k$</span>-vectors, which label frequencies in the decomposition of total charge density. The <em>Ewalder</em> implementation uses a straightforward algorithm that scales as <span>$N^{3/2}$</span> for increasing system sizes <span>$N$</span> (assuming efficient calculation of the neighbor list). For very large scale simulations, it would be preferable to use instead a method that scales near-linearly with <span>$N$</span>, such as <a href="https://doi.org/10.1021/ct900275y">Smooth Particle Mesh Ewald</a>.</p><h3 id="Mathematical-details"><a class="docs-heading-anchor" href="#Mathematical-details">Mathematical details</a><a id="Mathematical-details-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-details" title="Permalink"></a></h3><p>The full Ewald method is summarized below. See our <a href="https://raw.githubusercontent.com/SunnySuite/Ewalder.jl/main/docs/math/ewald_review.pdf">mathematical writeup</a> (PDF format) for the derivation. </p><p>The Ewald energy for a system of charges decomposes into three parts,</p><p class="math-container">\[E = E_S + E_L - E_\mathrm{self}.\]</p><p>The &quot;short-range&quot; energy is a sum of pairwise interactions real-space,</p><p class="math-container">\[E_{S} =\frac{1}{4\pi\epsilon_{0}}\frac{1}{2} \sum_{i,j,\mathbf{n}}{\vphantom{\sum}}&#39; \frac{q_{i}q_{j}}{r_{ij\mathbf{n}}}\mathrm{erfc}\left(\frac{r_{ij\mathbf{n}}}{\sqrt{2}\,\sigma}\right).\]</p><p>Observe that ions indexed by <span>$i$</span> and <span>$j$</span> can interact across periodic system images, <span>$\mathbf{n} \in \mathbb{R}^3$</span>. The prime in <span>$\sum&#39;$</span> indicates that infinite self-interactions (<span>$i=j$</span> and <span>$\mathbf{n}=\mathbf{0}$</span>) should be excluded from the sum. The periodic system may be sheared and the distance between image charges,</p><p class="math-container">\[\mathbf{r}_{ij\mathbf{n}} = \big|\mathbf{r}_j - \mathbf{r}_i + \sum_\alpha n_\alpha \mathbf{a}_\alpha \big|,\]</p><p>involves three (super-) lattice vectors <span>$\mathbf{a}_\alpha$</span>. The complementary error function <span>$\mathrm{erfc}(x)$</span> decays rapidly in its argument <span>$x$</span>, such that the real-space interactions are localized to <span>$r_{ij\mathbf{n}} \lesssim \sigma$</span>. The length scale <span>$\sigma$</span> is a tuneable parameter that can be adjusted for numerical efficiency.</p><p>The &quot;long-range&quot; energy is a sum over Fourier modes</p><p class="math-container">\[E_{L}=\frac{1}{2V\epsilon_{0}}\sum_{\mathbf{k}\neq\mathbf{0}}\frac{e^{-\sigma^{2}k^{2}/2}}{k^{2}}\left|\hat{\rho}(\mathbf{k})\right|^{2},\]</p><p>involving the Fourier transform of charge density,</p><p class="math-container">\[\hat{\rho}(\mathbf{k})=\sum_{i}q_{i}e^{-i\mathbf{k}\cdot\mathbf{r}_{i}},\]</p><p>and the system volume <span>$V = (\mathbf{a}_1 \times \mathbf{a}_2) \cdot \mathbf{a}_3$</span>. The sum runs overs Fourier modes consistent with the assumed periodicity, i.e. <span>$\mathbf{k} = \sum_\alpha m_\alpha \mathbf{b}_\alpha$</span> for integer <span>$m_\alpha$</span> and reciprocal (super-) lattice vectors defined to satisfy <span>$\mathbf{a}_\alpha \cdot \mathbf{b}_\beta = 2\pi \delta_{\alpha \beta}$</span>. The assumption of charge neutrality, <span>$\hat{\rho}(\mathbf{0}) = 0$</span>, justifies the removal of the mode <span>$\mathbf{k}=\mathbf{0}$</span>. Due to the Gaussian decay, only modes with <span>$|\mathbf{k}| \lesssim 1/\sigma$</span> are relevant to the sum.</p><p>The energy <span>$E_L$</span> can equivalently be viewed as an infinite real-space sum over Gaussian charge clouds. This periodic sum includes artificial &quot;self&quot; interactions,</p><p class="math-container">\[E_{\mathrm{self}}=\frac{1}{4\pi\epsilon_{0}}\frac{1}{\sqrt{2\pi}\,\sigma}\sum_{i}q_{i}^{2},\]</p><p>which must be removed from the final energy output <span>$E$</span>.</p><p>Both real- and Fourier- space sums are rapidly convergent. <em>Ewalder</em> truncates these sums using the inequalities,</p><p class="math-container">\[r_{ij\mathbf{n}} \leq c_0 \sqrt{2} \sigma \\
|\mathbf{k}_{\mathbf{m}}| \leq c_0 \sqrt{2} / \sigma\]</p><p>where <span>$c_0$</span> is a dimensionless parameter (defaulting to <span>$c_0 = 6$</span> for about 13 digits of accuracy).</p><p>Apart from the small truncation error, the energy <span>$E$</span> is mathematically independent of the parameter <span>$\sigma$</span>. A good choice of <span>$\sigma$</span> should balance between the cost of the real-space sums in <span>$E_S$</span> and the Fourier-space sums in <span>$E_L$</span>. Consider systems of fixed density, but with varying sizes controlled by the number of ions <span>$N$</span>. This package selects</p><p class="math-container">\[\sigma = L / c_1 N^{1/6},\]</p><p>where <span>$c_1$</span> is a dimensionless parameter (defaulting to <span>$c_1 = 2$</span>) and <span>$L = V^{1/3}$</span>. This choice achieves, in principle, a total computational cost that scales as <span>$O(N^{3/2})$</span>, provided that the ion neighbor lists are calculated efficiently. For maximum efficiency, the user should provide a neighbor list. If one is not provided, this package will perform inefficient, brute-force calculation of the neighbor list.</p><p>In addition to point charges, <em>Ewalder</em> also allows specification of point dipoles, each of which generates an electrostatic potential that decays like <span>$1/r^2$</span>, and can similarly be handled using Ewald summation. The final formulas can be found in our <a href="https://raw.githubusercontent.com/SunnySuite/Ewalder.jl/main/docs/math/ewald_review.pdf">PDF note</a>.</p><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><ul><li><a href="#Ewalder.System"><code>Ewalder.System</code></a></li><li><a href="#Ewalder.energy-Tuple{System}"><code>Ewalder.energy</code></a></li></ul><article class="docstring"><header><a class="docstring-binding" id="Ewalder.System" href="#Ewalder.System"><code>Ewalder.System</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">System(; latvecs::Vector{NTuple{3, Float}},
         pos::Vector{Vec3}
         c0::Float64 = 6.0
         c1::Float64 = 2.0)</code></pre><p>Create a system that is periodic in each of the three supercell lattice vectors <code>latvecs</code> and with atom positions <code>pos</code>. The optional parameter <code>c0</code> controls accuracy of Ewald summation. The default is <code>c0 = 6</code>, which yields errors of order <code>1e-12</code> (smaller <code>c0</code> will run faster). The optional parameter <code>c1</code> controls the balance between real and Fourier space summation (larger <code>c1</code> implies more real-space summation).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SunnySuite/Ewalder.jl/blob/e15a5514f8b631aa927ae333516e032d10cad46f/src/Ewalder.jl#L17-L29">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Ewalder.energy-Tuple{System}" href="#Ewalder.energy-Tuple{System}"><code>Ewalder.energy</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">energy(sys::System; charges=Float64[], dipoles=Vec3[])</code></pre><p>Calculate the Ewald energy in units of <span>$1/4\pi\epsilon_0$</span> for a periodic system of <code>charges</code> and <code>dipoles</code>. If either charge or dipole parameters are omitted, they will be assumed zero. A neighbors list can also be optionally provided; see the source code for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SunnySuite/Ewalder.jl/blob/e15a5514f8b631aa927ae333516e032d10cad46f/src/Ewalder.jl#L131-L138">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Friday 6 January 2023 20:26">Friday 6 January 2023</span>. Using Julia version 1.8.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
